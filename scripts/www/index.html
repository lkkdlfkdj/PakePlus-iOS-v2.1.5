<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>考勤管理系统</title>
    <link rel="stylesheet" href="styles-light.css">
</head>
<body>
    <div class="container">
        <header class="app-header">
            <h1>考勤管理</h1>
        </header>
        
        <nav class="tab-nav">
            <button class="tab-button active" onclick="showTab('overtime', this)">
                <span class="tab-icon">⏰</span>
                <span class="tab-text">加班</span>
            </button>
            <button class="tab-button" onclick="showTab('compensatory', this)">
                <span class="tab-icon">🔄</span>
                <span class="tab-text">补休</span>
            </button>
            <button class="tab-button" onclick="showTab('leave', this)">
                <span class="tab-icon">🏃</span>
                <span class="tab-text">请假</span>
            </button>
            <button class="tab-button" onclick="showTab('history', this)">
                <span class="tab-icon">📊</span>
                <span class="tab-text">历史</span>
            </button>
            <button class="tab-button" onclick="showTab('export', this)">
                <span class="tab-icon">📤</span>
                <span class="tab-text">导出</span>
            </button>
        </nav>

        <main class="main-content">
            <!-- 加班标签页 -->
            <div id="overtime" class="tab-content active">
                <div class="card">
                    <form id="overtimeForm" class="mobile-form">
                        <div class="form-group">
                            <label for="overtimeDate">加班日期</label>
                            <input type="date" id="overtimeDate" required>
                        </div>
                        <div class="form-group">
                            <label for="overtimeTimeSlot">时间段</label>
                            <select id="overtimeTimeSlot" required>
                                <option value="">请选择时间段</option>
                                <option value="morning">上午8:00-12:00</option>
                                <option value="afternoon">下午14:00-18:00</option>
                                <option value="evening">晚上19:00-23:00</option>
                                <option value="custom">自定义</option>
                            </select>
                        </div>
                        <div class="form-group" id="customOvertimeTimeSlot" style="display: none;">
                            <label for="customOvertimeTimeText">自定义时间段</label>
                            <input type="text" id="customOvertimeTimeText" placeholder="请输入自定义时间段，如：09:00-17:00">
                        </div>
                        <div class="form-group">
                            <label for="overtimeReason">加班原因</label>
                            <select id="overtimeReason" required>
                                <option value="">请选择加班原因</option>
                                <option value="saturday">周六加班</option>
                                <option value="weekend">周末加班</option>
                                <option value="city">创城加班</option>
                                <option value="custom">自定义</option>
                            </select>
                        </div>
                        <div class="form-group" id="customOvertimeReason" style="display: none;">
                            <label for="customOvertimeText">自定义原因</label>
                            <input type="text" id="customOvertimeText" placeholder="请输入自定义原因">
                        </div>
                        <button type="submit" class="submit-btn">提交加班申请</button>
                    </form>
                </div>
            </div>

            <!-- 补休标签页 -->
            <div id="compensatory" class="tab-content">
                <div class="card">
                    <form id="compensatoryForm" class="mobile-form">
                        <div class="form-group">
                            <label for="compensatoryDate">补休日期</label>
                            <input type="date" id="compensatoryDate" required>
                        </div>
                        <div class="form-group">
                            <label for="attendanceTeam">考勤队伍</label>
                            <div class="input-with-lock">
                                <select id="attendanceTeam" required>
                                    <option value="">请选择考勤队伍</option>
                                    <option value="law1">执法一中队</option>
                                    <option value="law2">执法二中队</option>
                                    <option value="law3">执法三中队</option>
                                    <option value="law4">执法四中队</option>
                                </select>
                                <button type="button" id="teamModifyBtn" onclick="toggleTeamLock()" class="lock-btn">🔓</button>
                                <button type="button" id="teamFixBtn" onclick="toggleTeamLock()" class="lock-btn fixed" style="display: none;">🔒</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="attendanceGroup">考勤组</label>
                            <div class="input-with-lock">
                                <select id="attendanceGroup" required>
                                    <option value="">请选择考勤组</option>
                                    <option value="jiaonan1">蕉南一组</option>
                                    <option value="jiaonan2">蕉南二组</option>
                                    <option value="jiaonan3">蕉南三组</option>
                                    <option value="jiaonan4">蕉南四组</option>
                                </select>
                                <button type="button" id="groupModifyBtn" onclick="toggleGroupLock()" class="lock-btn">🔓</button>
                                <button type="button" id="groupFixBtn" onclick="toggleGroupLock()" class="lock-btn fixed" style="display: none;">🔒</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="shiftSchedule">班次</label>
                            <div class="input-with-lock">
                                <select id="shiftSchedule" required>
                                    <option value="">请选择班次</option>
                                    <option value="A14">A14</option>
                                    <option value="A16">A16</option>
                                    <option value="A17">A17</option>
                                    <option value="A18">A18</option>
                                    <option value="A19">A19</option>
                                    <option value="A2">A2</option>
                                    <option value="A20">A20</option>
                                    <option value="A21">A21</option>
                                    <option value="A22">A22</option>
                                    <option value="A23">A23</option>
                                    <option value="A27">A27</option>
                                    <option value="A30">A30</option>
                                    <option value="A31">A31</option>
                                    <option value="A32">A32</option>
                                    <option value="A35">A35</option>
                                    <option value="A37">A37</option>
                                    <option value="A39">A39</option>
                                    <option value="A40">A40</option>
                                    <option value="A46">A46</option>
                                    <option value="A47">A47</option>
                                    <option value="A48">A48</option>
                                    <option value="A49">A49</option>
                                    <option value="A50">A50</option>
                                    <option value="A51">A51</option>
                                    <option value="A52">A52</option>
                                    <option value="A53">A53</option>
                                    <option value="A54">A54</option>
                                    <option value="A55">A55</option>
                                    <option value="A56">A56</option>
                                    <option value="A57">A57</option>
                                    <option value="A58">A58</option>
                                    <option value="A59">A59</option>
                                    <option value="A65">A65</option>
                                    <option value="A66">A66</option>
                                    <option value="A69">A69</option>
                                    <option value="A7">A7</option>
                                    <option value="A71">A71</option>
                                    <option value="A74">A74</option>
                                    <option value="A8">A8</option>
                                </select>
                                <button type="button" id="shiftModifyBtn" onclick="toggleShiftLock()" class="lock-btn">🔓</button>
                                <button type="button" id="shiftFixBtn" onclick="toggleShiftLock()" class="lock-btn fixed" style="display: none;">🔒</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="compensatoryTimeSlot">时间段</label>
                            <div id="shiftTimeDisplay" class="shift-time-display" style="display: none;">
                                <div class="time-info">请先选择班次</div>
                            </div>
                            <select id="compensatoryTimeSlot" required>
                                <option value="">请选择时间段</option>
                                <option value="morning">上午7:00-11:00</option>
                                <option value="afternoon">下午14:30-17:30</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>锁定控制</label>
                            <div class="lock-control-buttons">
                                <button type="button" onclick="unlockAll()" class="unlock-all-btn">取消所有锁定</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="relatedOvertime">关联加班记录</label>
                            <select id="relatedOvertime" required>
                                <option value="">请选择关联的加班记录</option>
                            </select>
                        </div>
                        <button type="submit" class="submit-btn">提交补休申请</button>
                    </form>
                </div>
            </div>

            <!-- 请假标签页 -->
            <div id="leave" class="tab-content">
                <div class="card">
                    <form id="leaveForm" class="mobile-form">
                        <div class="form-group">
                            <label for="leaveDate">请假日期</label>
                            <input type="date" id="leaveDate" required>
                        </div>
                        <div class="form-group">
                            <label for="leaveTimeSlot">时间段</label>
                            <select id="leaveTimeSlot" required>
                                <option value="">请选择时间段</option>
                                <option value="morning">上午7:00-11:00</option>
                                <option value="afternoon">下午14:30-17:30</option>
                                <option value="custom">自定义</option>
                            </select>
                        </div>
                        <div class="form-group" id="customLeaveTimeSlot" style="display: none;">
                            <label for="customLeaveTimeText">自定义时间段</label>
                            <input type="text" id="customLeaveTimeText" placeholder="请输入自定义时间段，如：09:00-15:00">
                        </div>
                        <div class="form-group">
                            <label for="leaveReason">请假原因</label>
                            <select id="leaveReason" required>
                                <option value="">请选择请假原因</option>
                                <option value="personal">事假</option>
                                <option value="sick">病假</option>
                                <option value="custom">自定义</option>
                            </select>
                        </div>
                        <div class="form-group" id="customLeaveReason" style="display: none;">
                            <label for="customLeaveText">自定义原因</label>
                            <input type="text" id="customLeaveText" placeholder="请输入自定义原因">
                        </div>
                        <button type="submit" class="submit-btn">提交请假申请</button>
                    </form>
                </div>
            </div>

            <!-- 历史视图标签页 -->
            <div id="history" class="tab-content">
                <div class="card">
                    <div class="statistics-mobile">
                        <div class="stat-card">
                            <div class="stat-number" id="totalOvertime">0</div>
                            <div class="stat-label">加班总次数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalCompensatory">0</div>
                            <div class="stat-label">补休总次数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="remainingCount">0</div>
                            <div class="stat-label">剩余次数</div>
                        </div>
                    </div>
                    
                    <div id="expirationWarning" class="warning-mobile" style="display: none;"></div>
                    
                    <!-- 万年历 -->
                    <div class="calendar-mobile">
                        <div class="calendar-header-mobile">
                            <button id="prevMonth" class="calendar-nav-mobile">‹</button>
                            <span id="currentMonth" class="calendar-title-mobile"></span>
                            <button id="nextMonth" class="calendar-nav-mobile">›</button>
                        </div>
                        <div class="calendar-legend-mobile">
                            <span class="legend-item-mobile"><span class="legend-dot overtime-color"></span>加班</span>
                            <span class="legend-item-mobile"><span class="legend-dot compensatory-color"></span>补休</span>
                            <span class="legend-item-mobile"><span class="legend-dot leave-color"></span>请假</span>
                            <span class="legend-item-mobile"><span class="legend-dot full-compensatory-color"></span>全补</span>
                        </div>
                        <div id="calendar" class="calendar-grid-mobile"></div>
                    </div>
                    
                    <div class="history-list-mobile" id="historyList"></div>
                </div>
            </div>

            <!-- 导出标签页 -->
            <div id="export" class="tab-content">
                <div class="card">
                    <div class="export-section">
                        <h3>筛选条件</h3>
                        <div class="export-filters-mobile">
                            <div class="form-group">
                                <label for="exportYear">年份</label>
                                <select id="exportYear">
                                    <option value="">全部年份</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="exportMonth">月份</label>
                                <select id="exportMonth">
                                    <option value="">全部月份</option>
                                    <option value="01">1月</option>
                                    <option value="02">2月</option>
                                    <option value="03">3月</option>
                                    <option value="04">4月</option>
                                    <option value="05">5月</option>
                                    <option value="06">6月</option>
                                    <option value="07">7月</option>
                                    <option value="08">8月</option>
                                    <option value="09">9月</option>
                                    <option value="10">10月</option>
                                    <option value="11">11月</option>
                                    <option value="12">12月</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="exportType">导出类型</label>
                                <select id="exportType" onchange="updateFieldOptions()">
                                    <option value="overtime">加班记录</option>
                                    <option value="compensatory">补休记录</option>
                                    <option value="leave">请假记录</option>
                                    <option value="all">全部记录</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 字段选择区域 -->
                    <div class="field-selection-mobile">
                        <h3>选择字段</h3>
                        <div class="field-templates-mobile">
                            <button type="button" onclick="selectAllFields()" class="template-btn-mobile">全选</button>
                            <button type="button" onclick="clearAllFields()" class="template-btn-mobile">清空</button>
                            <button type="button" onclick="loadTemplate('basic')" class="template-btn-mobile">基础</button>
                            <button type="button" onclick="loadTemplate('detailed')" class="template-btn-mobile">详细</button>
                        </div>
                        
                        <!-- 字段选择组 -->
                        <div id="overtimeFields" class="field-group-mobile">
                            <div class="field-checkboxes-mobile">
                                <label class="checkbox-mobile"><input type="checkbox" value="加班日期" checked><span>加班日期</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="时间段" checked><span>时间段</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="加班原因" checked><span>加班原因</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="状态" checked><span>状态</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="创建时间"><span>创建时间</span></label>
                            </div>
                        </div>
                        
                        <div id="compensatoryFields" class="field-group-mobile" style="display: none;">
                            <div class="field-checkboxes-mobile">
                                <label class="checkbox-mobile"><input type="checkbox" value="补休日期" checked><span>补休日期</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="考勤队伍" checked><span>考勤队伍</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="考勤组" checked><span>考勤组</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="班次" checked><span>班次</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="班次时间"><span>班次时间</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="时间段" checked><span>时间段</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="关联加班日期" checked><span>关联加班日期</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="关联加班时间段" checked><span>关联加班时间段</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="加班原因" checked><span>加班原因</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="创建时间"><span>创建时间</span></label>
                            </div>
                        </div>
                        
                        <div id="leaveFields" class="field-group-mobile" style="display: none;">
                            <div class="field-checkboxes-mobile">
                                <label class="checkbox-mobile"><input type="checkbox" value="请假日期" checked><span>请假日期</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="时间段" checked><span>时间段</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="请假原因" checked><span>请假原因</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="创建时间"><span>创建时间</span></label>
                            </div>
                        </div>
                        
                        <div id="allFields" class="field-group-mobile" style="display: none;">
                            <div class="field-checkboxes-mobile">
                                <label class="checkbox-mobile"><input type="checkbox" value="类型" checked><span>类型</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="日期" checked><span>日期</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="时间段" checked><span>时间段</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="详细信息" checked><span>详细信息</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="队伍/组"><span>队伍/组</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="班次"><span>班次</span></label>
                                <label class="checkbox-mobile"><input type="checkbox" value="创建时间"><span>创建时间</span></label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="export-actions-mobile">
                        <button onclick="showExportPreview()" class="preview-btn-mobile">显示结果</button>
                        <button onclick="exportFilteredData()" class="export-btn-mobile">保存到记事本</button>
                    </div>
                    
                    <div class="export-result-mobile">
                        <label for="exportTextArea">导出结果</label>
                        <textarea id="exportTextArea" rows="10" readonly placeholder="点击显示结果或导出数据按钮后，内容将显示在这里..." style="height: 200px; resize: none;"></textarea>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- 事件详情弹窗 -->
        <div id="eventModal" class="modal-mobile" style="display: none;">
            <div class="modal-content-mobile">
                <div class="modal-header-mobile">
                    <h3 id="modalTitle">事件详情</h3>
                    <button class="close-mobile" onclick="closeEventModal()">×</button>
                </div>
                <div class="modal-body-mobile" id="modalBody">
                    <!-- 事件详情内容 -->
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // 标签页功能修复
        console.log('🔧 加载标签页修复脚本');
        
        // 确保showTab函数可用
        window.showTab = function(tabName, buttonElement) {
            console.log('切换标签页:', tabName);
            
            // 隐藏所有标签页
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有按钮活动状态
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // 显示目标标签页
            const targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // 激活按钮
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // 执行特定逻辑
            setTimeout(() => {
                try {
                    if (tabName === 'history') {
                        if (typeof updateStatistics === 'function') updateStatistics();
                        if (typeof updateHistoryView === 'function') updateHistoryView();
                        if (typeof checkExpirationWarnings === 'function') checkExpirationWarnings();
                        if (typeof renderCalendar === 'function') renderCalendar();
                    }
                    if (tabName === 'compensatory') {
                        if (typeof updateRelatedOvertimeOptions === 'function') updateRelatedOvertimeOptions();
                        if (typeof updateTimeSlotByShift === 'function') updateTimeSlotByShift();
                    }
                    if (tabName === 'export') {
                        if (typeof updateExportYearOptions === 'function') updateExportYearOptions();
                    }
                } catch (e) {
                    console.warn('执行标签页逻辑时出错:', e);
                }
            }, 100);
        };
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM加载完成，初始化标签页');
            
            // 确保第一个标签页是活动的
            const firstTab = document.getElementById('overtime');
            const firstButton = document.querySelector('.tab-button');
            
            if (firstTab) firstTab.classList.add('active');
            if (firstButton) firstButton.classList.add('active');
            
            console.log('标签页初始化完成');
        });
    </script>
</body>
</html>